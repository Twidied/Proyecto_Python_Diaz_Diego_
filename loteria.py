import os
import json
import random

def limpiar_pantalla():
    os.system("cls" if os.name == "nt" else "clear")


print("""
+__________________________________________________________________________________________________________________________________________________+
โ     โ              โ              โ                                                                                                               โ
โ                                               โ                       โ               โ           โ                โ                      โ       โ
โ            โ               โ   โโโโโโโ โโโโโโโโโโโโโโโ   โโโโโโ   โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโ  โโโโโโโ                       โ                โ
โ   โ               โ            โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ   โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ          โ                        โ   โ
โ                                โโโโโโโโโโโโโโโโโ  โโโโโโ โโโโโโ   โโโโโโโโโ  โโโโโโ โโโโโโโโโ  โโโโโโ   โโโ                                       โ
โ                                โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ โโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโ   โโโ                                 โ     โ
โ          โ          โ          โโโโโโโโโโโโโโโโโโโโโโ โโโโโโ โโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโโโโโโโโ          โ            โ              โ
โ                                โโโโโโโ โโโโโโโโโโโโโโ  โโโโโ  โโโโโ  โโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโ                                        โ
โ        โ                     โ          โ                    โโโโโโโโโโโโโโ                   โ                                                   โ
โ                                                  โ           โโโโโโโโโโโโโโ      โ                     โ          โ         โ         โ           โ
โ   โ                โ                                         โโโโโโโโโโโโโโ            โ       โ                                                  โ
โ       โ                                   โโโ      โโโโโโโ โโโโโโโโโโโโโโโโโโโโโโโโ โโโ โโโโโโโ     โ         โ                              โ    โ
โ โ                                         โโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                                   โ
โ                             โ        โ    โโโ     โโโ   โโโ   โโโ   โโโโโโ  โโโโโโโโโโโโโโโโโโโ           โ                โ            โ         โ
โ            โ                              โโโ     โโโ   โโโ   โโโ   โโโโโโ  โโโโโโโโโโโโโโโโโโโ                                                   โ
โ                         โ                 โโโโโโโโโโโโโโโโโ   โโโ   โโโโโโโโโโโ  โโโโโโโโโ  โโโ                   โ                               โ
โ   โ                               โ       โโโโโโโโ โโโโโโโ    โโโ   โโโโโโโโโโโ  โโโโโโโโโ  โโโ   โ                        โ            โ         โ
โ          โ             โ                 โ           โ                 โ           โ                      โ           โ                           โ
+__________________________________________________________________________________________________________________________________________________+
""")

input("presiona enter para continuar")
limpiar_pantalla()


def comprar_boletos():
    limpiar_pantalla()
    
    print("""
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
""")
    while True:
        titular = input("Ingresa el nombre del titular del boleto: ")
        if titular == "":
            print("El nombre no puede estar vacio. Intentalo de nuevo.")
        elif any(char.isdigit() for char in titular):
            print("El nombre no puede contener numeros. Intentalo nuevamente.")
        else:
            break

    numeros_usados = set()
    historial_path = "historial_usuario.json"
    try:
        with open("historial_usuario.json", "r", encoding="utf-8") as archivo:
            historial = json.load(archivo)
            for item in historial:
                numeros_usados.add(item["boleto"])
    except (FileNotFoundError, json.JSONDecodeError):
        historial = []

    while True:
        entrada = input("Ingrese un numero valido entre 0 y 99999: ").strip()

        if not entrada.isdigit():
            print("Por favor, ingrese un numero entero valido.")
            continue

        boleto_num = int(entrada)

        if boleto_num in numeros_usados:
            print("Este numero ya fue comprado. Por favor ingresa otro.")
            continue

        if 0 <= boleto_num <= 99999:
            boleto = {
            "Titular": titular,
            "boleto": boleto_num
            }
            historial.append(boleto)

            with open(historial_path, "w", encoding="utf-8") as archivo:
                json.dump(historial, archivo, ensure_ascii=False, indent=4)

            print("Boleto registrado exitosamente.")
            input("Presiona ENTER para continuar...")
            break
        else:
            print("El numero debe estar entre 0 y 99999. Intenta nuevamente.")

def mostrar_historial():
    print("Aqui esta tu historial de compras:\n")
    historial_path = "historial_usuario.json"

    if not os.path.exists(historial_path):
        print("No se encontro ningun historial de compras.")
    else:
        with open(historial_path, "r", encoding="utf-8") as archivo:
            try:
                historial = json.load(archivo)
                if not historial:
                    print("aun no hay compras registradas")
                else:
                    for boleto in historial:
                        print(f"Titular: {boleto['Titular']}")
                        print(f"Boleto: {boleto['boleto']:05}")
                        print("-" * 30)
            except json.JSONDecodeError:
                input("no se pudo cargar correctamente el hisorial")
    input("presiona ENTER para continuar.")
    limpiar_pantalla()




def numeros_aleatorios():
    while True:
        try:
            numero_ganador = random.randint(0, 99999)
            return numero_ganador 
        except Exception as e:
            print("no se pudo generar el numero ganador:", e)
            return None



def verificar_premios(numero_ganador):
    try:
        with open("historial_usuario.json", "r", encoding="utf-8") as archivo:
            mostrar_historial = json.load(archivo)

        print(f"\nNUMERO GANADOR: {numero_ganador:05}")
        print("RESULTADOS DE LOS BOLETOS COMPRADOS:\n")

        for boleto in mostrar_historial:
            numero = str(boleto["boleto"]).zfill(5)
            ganador = str(numero_ganador).zfill(5)

            aciertos = sum(1 for i in range(5) if numero[i] == ganador[i])

            if aciertos == 5:
                premio = "๐ Premio mayor"
            elif aciertos == 4:
                premio = "โจ Premio grande"
            elif aciertos == 3:
                premio = "๐ฏ Premio mediano"
            elif aciertos == 2:
                premio = "๐ Premio pequeรฑo"
            else:
                premio = "๐ Sin premio"

            boleto_str = str(boleto['boleto']).zfill(5)
            print(f"Titular: {boleto['Titular']:<5} Boleto: {str(boleto['boleto']).zfill(5)}  Aciertos: {aciertos:<2}  Premio: {premio}")
    except FileNotFoundError:
        print("โ๏ธ No se encontro el archivo 'historial_usuario.json'. Asegurate de haber comprado boletos.")
    except Exception as e:
        print(f"Error al verificar premios: {e}")
    input("\nPresiona ENTER para continuar...")


def ver_explicacion_premios():
    limpiar_pantalla()

    print("""      
          
                  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          
                  ๐ 5 aciertos โ Premio mayor
                  โจ 4 aciertos โ Premio grande
                  ๐ฏ 3 aciertos โ Premio mediano
                  ๐ 2 aciertos โ Premio pequeรฑo
                  ๐ 0-1 aciertos โ Sin premio
""")
    input("Presiona ENTER para volver al menu...")



def chau():
    try:
        limpiar_pantalla()
        print("""
+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+.+ยบ+.+ยบ+ยบ+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.  
|                                                                                                                                                |
|                           โโโโโโโโโ  โโโโโโโโโโโ     โโโโโโโโโ     โโโโโโโโโ  โโโโโ   โโโโโโโโโ       โโโโโโโโโ โโโ                            |
|                          โโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโ   โโโโโโโโโโโโโโโโ   โโโโโโโโโโโ   โโโโโโโโโโโ โโโโ                            |
|                         โโโ     โโโ  โโโโ    โโโโ  โโโโ    โโโโ  โโโ     โโโ  โโโโ  โโโโ    โโโโ  โโโโ    โโโ  โโโโ                            |
|                        โโโโ          โโโโโโโโโโโ   โโโโโโโโโโโโ โโโโ          โโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโ  โโโโ                            |
|                        โโโโ    โโโโโ โโโโโโโโโโโโ  โโโโโโโโโโโโ โโโโ          โโโโ  โโโโโโโโโโโโ   โโโโโโโโโโโ โโโโ                            |
|                        โโโโโ  โโโโโ  โโโโ    โโโโ  โโโโ    โโโโ โโโโโ     โโโ โโโโ  โโโโ    โโโโ   โโโ    โโโโ โโโ                             |
|                         โโโโโโโโโโโ  โโโโโ   โโโโโ โโโโโ   โโโโโ โโโโโโโโโโโ  โโโโโ โโโโโ   โโโโโ โโโโโโโโโโโ   โโโ                            |
|                          โโโโโโโโโ  โโโโโ   โโโโโ โโโโโ   โโโโโ   โโโโโโโโโ  โโโโโ โโโโโ   โโโโโ    โโโโโโโโโ   โโโ                            |
|                                                                                                                                                |
|                                       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                             |
|                                       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                             |
|                                       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                             |
|                                                                                                                                                |
+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+.+ยบ+.+ยบ+ยบ+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.+ยบ+.
""")
    except  Exception:
        print("\nNo c\n")
        input("Presiona Enter para salir")



def menu():
    while True:
        try:
            limpiar_pantalla()
            print("""
__________________________________________________________________________________________________________________________________________________
|                               โ                                                                               โ         โ                    โ  |
|           โ                              โโโโโโ   โโโโโโ โโโโโโโโโโ โโโโโโ   โโโโโ โโโโโ  โโโโโ                                     โ           |
| โ                   โ          โ        โโโโโโโโ โโโโโโ โโโโโโโโโโโโโโโโโโโ โโโโโ โโโโโ  โโโโโ       โ         โ          โ                     |
|                                          โโโโโโโโโโโโโโ  โโโโ  โ โ  โโโโโโโโ โโโโ  โโโโ   โโโโ                                            โ     |  
|           โ                โ             โโโโโโโโโ โโโโ  โโโโโโโ    โโโโโโโโโโโโโ  โโโโ   โโโโ                     โ           โ                |
| โ                    โ           โ       โโโโ โโโ  โโโโ  โโโโโโโ    โโโโ โโโโโโโโ  โโโโ   โโโโ       โ                                          |
|                                          โโโโ      โโโโ  โโโโ โ   โ โโโโ  โโโโโโโ  โโโโ   โโโโ               โ           โ              โ       |
|                โ                         โโโโโ     โโโโโ โโโโโโโโโโ โโโโโ  โโโโโโโ โโโโโโโโโโ                                                   |
|        โ                 โ          โ    โโโโโ     โโโโโ โโโโโโโโโโ โโโโโ    โโโโโ   โโโโโโโโ      โ            โ         โ       โ             |
|                                                                                                                                                 |
|     โ       โ             โ            โ            โ                  โ                  โ                      โ           โ                  |
|                                                               1.COMPRAR BOLETOS                                                          โ      |
|                   โ              โ             โ          โ   2.SORTEO VIRTUAL                     โ                                            |
|       โ                                                       3.HISTORIAL        โ           โ                      โ               โ           |                                                                  
|    โ                                โ             โ           4.PREMIOS                                                                         |
|                โ         โ              โ                     5.SALIR    โ                                    โ                 โ               |
|_________________________________________________________________________________________________________________________________________________|
 """)

            opcion = input("ingresa el numero de lo que quieras realizar: ")

            if opcion == "1":
                comprar_boletos()
                limpiar_pantalla()
            elif opcion == "2":
                numero_ganador = numeros_aleatorios()
                verificar_premios(numero_ganador)

                limpiar_pantalla()
            
            elif opcion == "3":
                mostrar_historial()
                limpiar_pantalla()
            elif opcion == "4":
                ver_explicacion_premios()
                limpiar_pantalla()

            elif opcion == "5":
                chau()
                print("saliendo...")
                break
            else:
                print("Incorrecto. Esa opcion no existe ๐")
        except KeyboardInterrupt:
            print("\nPrograma interrumpido por el usuario.")
menu()
